#!/bin/bash

NUMBER="$1"

set -v

export HOMEBREW_BASERUBY="$HOME/.rubies/ruby-${NUMBER}/bin/ruby"
export HOMEBREW_RUSTUP_HOME="$HOME/.rustup"

if [[ (! -f "$HOMEBREW_BASERUBY") && "0.49" != "$NUMBER" ]]; then
  brew install ruby-install
  (which apt && sudo apt update) || true
  ruby-install "$NUMBER"
fi

brew uninstall --force "rv-ruby@${NUMBER}"

brew rv-package "rv-ruby@${NUMBER}" \
  --no-uninstall-deps \
  --debug \
  --verbose \
  --with-yjit
